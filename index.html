
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TADY - Ukotvení vzkazu</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; background: #000; }
        .ui-layer {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; z-index: 100; text-align: center;
        }
        .glass {
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px);
            padding: 20px; border-radius: 20px; border: 1px solid #00f2ff; color: white;
        }
        .crosshair {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 40px; height: 40px; border: 2px solid #00f2ff; border-radius: 50%;
            z-index: 50; pointer-events: none;
        }
        .btn {
            background: #00f2ff; color: black; border: none; padding: 15px; 
            width: 100%; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px;
        }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; border-radius: 8px; border: none; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="crosshair" id="cross"></div>

    <div class="ui-layer" id="ui">
        <div class="glass" id="input-step">
            <h3 style="margin:0; color:#00f2ff;">TADY</h3>
            <input type="text" id="jmeno" placeholder="Jméno / Firma">
            <textarea id="vzkaz" placeholder="Váš vzkaz..."></textarea>
            <p style="font-size: 11px; opacity:0.7;">1. Napište text <br> 2. Namiřte středem na místo <br> 3. Zaplaťte a ukotvěte</p>
            <button class="btn" onclick="goToPayment()">POKRAČOVAT K PLATBĚ</button>
        </div>

        <div class="glass" id="payment-step" style="display:none;">
            <p style="font-size:14px;">Pro trvalé ukotvení odešlete 500 Kč:</p>
            <div style="background:#111; padding:10px; border-radius:10px; font-family:monospace; font-size:12px; border:1px solid #00f2ff;">
                IBAN: LT533250082844018353<br>
                VS: TADY <span id="payment-name"></span>
            </div>
            <button class="btn" onclick="anchorMessage()">ZAPLACENO - UKOTVIT NA MÍSTĚ</button>
        </div>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
        <a-entity camera look-controls id="my-camera">
            <a-entity id="preview-text" position="0 0 -3" visible="false">
                <a-plane width="3" height="1.2" color="#000" opacity="0.6"></a-plane>
                <a-text value="" align="center" color="#00f2ff" width="2.8"></a-text>
            </a-entity>
        </a-entity>

        <a-entity id="anchor-world"></a-entity>
    </a-scene>

    <script>
        const preview = document.getElementById('preview-text');
        const previewTxt = preview.querySelector('a-text');

        // Neustále aktualizujeme náhled textu podle vstupu
        document.getElementById('vzkaz').addEventListener('input', (e) => {
            if(e.target.value) {
                preview.setAttribute('visible', 'true');
                previewTxt.setAttribute('value', e.target.value);
            }
        });

        function goToPayment() {
            const name = document.getElementById('jmeno').value;
            if(!name) return alert("Zadejte jméno.");
            document.getElementById('payment-name').innerText = name;
            document.getElementById('input-step').style.display = 'none';
            document.getElementById('payment-step').style.display = 'block';
        }

        function anchorMessage() {
            const camera = document.getElementById('my-camera');
            const world = document.getElementById('anchor-world');
            const vzkaz = document.getElementById('vzkaz').value;
            const jmeno = document.getElementById('jmeno').value;

            // Získáme aktuální rotaci a pozici kamery, abychom vzkaz "přibili" do světa
            const position = new THREE.Vector3();
            const rotation = new THREE.Quaternion();
            camera.object3D.getWorldPosition(position);
            camera.object3D.getWorldQuaternion(rotation);

            // Výpočet bodu 3 metry před kamerou
            const direction = new THREE.Vector3(0, 0, -3);
            direction.applyQuaternion(rotation);
            position.add(direction);

            // Vytvoření stacionárního objektu v AR světě
            const newAnchor = document.createElement('a-entity');
            newAnchor.setAttribute('position', `${position.x} ${position.y} ${position.z}`);
            
            // Otočíme vzkaz čelem k uživateli v momentě ukotvení
            const camRot = camera.getAttribute('rotation');
            newAnchor.setAttribute('rotation', `0 ${camRot.y} 0`);

            newAnchor.innerHTML = `
                <a-plane width="3" height="1.5" color="#000" opacity="0.8" material="transparent:true">
                    <a-text value="${jmeno}:\n${vzkaz}" align="center" color="#00f2ff" width="2.5"></a-text>
                </a-plane>
                <a-ring color="#00f2ff" radius-inner="0.1" radius-outer="0.15" position="0 -1 0" rotation="-90 0 0"></a-ring>
            `;

            world.appendChild(newAnchor);

            // Skryjeme UI a náhled
            preview.setAttribute('visible', 'false');
            document.getElementById('ui').style.display = 'none';
            document.getElementById('cross').style.display = 'none';
            
            alert("Vzkaz byl ukotven na tomto místě!");
        }
    </script>
</body>
</html>

