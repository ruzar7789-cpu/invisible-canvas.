<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TADY | Everything is Here</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #ffd700; --cyan: #00f2ff; --bg: #000000; --glass: rgba(255,255,255,0.1); --neon-p: #bc13fe; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; overflow: hidden; }
        
        /* AR ENGINE LAYER */
        #ar-engine { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; display: none; filter: brightness(1.1) contrast(1.1); }
        #ar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }

        /* BRANDING */
        header { position: relative; z-index: 100; padding: 50px 20px 20px; text-align: center; transition: 0.5s; }
        .logo { font-size: 3.5rem; font-weight: 900; letter-spacing: 15px; margin: 0; background: linear-gradient(to right, #fff, var(--cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 20px rgba(0,242,255,0.5)); }
        .creator { position: fixed; top: env(safe-area-inset-top); right: 20px; font-weight: 900; color: var(--cyan); z-index: 1000; letter-spacing: 3px; font-size: 0.8rem; }

        /* DYNAMIC AR BUBBLES */
        .bubble { 
            position: absolute; min-width: 160px; padding: 20px; border-radius: 30px; 
            backdrop-filter: blur(25px); background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            animation: floating 6s ease-in-out infinite; pointer-events: auto; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .bubble.gold { border: 2px solid var(--gold); box-shadow: 0 0 40px rgba(255,215,0,0.3); color: var(--gold); }
        .bubble .meta { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; opacity: 0.7; }
        
        @keyframes floating { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(5px, -30px) scale(1.05); } }

        /* MAIN UI CONTAINER */
        .app-container { position: relative; z-index: 50; padding: 0 20px; height: 100%; display: flex; flex-direction: column; transition: 0.5s; }
        #map { flex-grow: 1; width: 100%; border-radius: 40px; border: 1px solid var(--glass); margin: 20px 0; box-shadow: 0 0 50px rgba(0,0,0,1); }
        
        /* INTERFACE CARDS */
        .panel { background: var(--glass); backdrop-filter: blur(30px); border-radius: 40px; padding: 30px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 120px; }
        textarea { width: 100%; background: transparent; border: none; color: white; font-size: 1.3rem; outline: none; resize: none; font-weight: 400; }
        
        .btn-row { display: flex; gap: 15px; margin-top: 20px; }
        .btn { flex: 1; padding: 20px; border-radius: 25px; font-weight: 900; cursor: pointer; border: none; transition: 0.2s; font-size: 0.9rem; letter-spacing: 1px; }
        .btn:active { transform: scale(0.95); }
        .btn-s { background: #fff; color: #000; }
        .btn-g { background: var(--gold); color: #000; box-shadow: 0 0 20px rgba(255,215,0,0.4); }

        /* NEON NAVIGATION */
        .navbar { 
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); 
            background: rgba(0,0,0,0.9); padding: 15px 45px; border-radius: 100px; 
            display: flex; gap: 50px; border: 1px solid var(--glass); z-index: 1000;
        }
        .nav-link { font-size: 2.2rem; cursor: pointer; opacity: 0.3; transition: 0.4s; filter: grayscale(1); }
        .nav-link.active { opacity: 1; filter: grayscale(0); transform: scale(1.3) translateY(-10px); }

        .hidden { display: none !important; opacity: 0; }
    </style>
</head>
<body>

<video id="ar-engine" autoplay playsinline></video>
<div id="ar-overlay"></div>
<div class="creator">M.D.</div>

<header id="app-header">
    <h1 class="logo">TADY</h1>
    <div style="font-size: 0.6rem; letter-spacing: 5px; color: var(--cyan); margin-top: 10px; font-weight: 900;">WORLD OPERATING SYSTEM</div>
</header>

<div class="app-container" id="ui-main">
    <div id="map"></div>
    
    <div class="panel">
        <textarea id="input-field" placeholder="Co chcete svƒõtu ≈ô√≠ct pr√°vƒõ TADY?" rows="2"></textarea>
        <div class="btn-row">
            <button class="btn btn-s" onclick="create('social')">SOCI√ÅLN√ç</button>
            <button class="btn btn-g" onclick="create('gold')">BYZNYS 29,-</button>
        </div>
    </div>
</div>

<nav class="navbar">
    <div class="nav-link active" id="m-map" onclick="go('map')">üåç</div>
    <div class="nav-link" id="m-ar" onclick="go('ar')">‚ú®</div>
    <div class="nav-link" id="m-ai" onclick="go('ai')">üß†</div>
</nav>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const G_KEY = "AIzaSyDOLpRJ9EOJvjPEWayPnWztnVdj8btUDA4";
    let map, userPos;

    function init() {
        map = L.map('map', {zoomControl: false, attributionControl: false}).setView([50.91, 14.62], 16);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png').addTo(map);
        
        // Sledov√°n√≠ polohy v re√°ln√©m ƒçase
        navigator.geolocation.watchPosition(p => {
            userPos = [p.coords.latitude, p.coords.longitude];
            map.panTo(userPos);
        });
        
        refreshData();
    }

    async function go(mode) {
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.getElementById('m-' + mode).classList.add('active');

        const cam = document.getElementById('ar-engine');
        const ui = document.getElementById('ui-main');
        const head = document.getElementById('app-header');
        const overlay = document.getElementById('ar-overlay');

        if(mode === 'ar') {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                cam.srcObject = stream;
                cam.style.display = 'block';
                ui.classList.add('hidden');
                head.style.opacity = '0';
                startAR();
            } catch(e) { alert("AR Engine pot≈ôebuje kameru."); }
        } else if(mode === 'map') {
            cam.style.display = 'none';
            ui.classList.remove('hidden');
            head.style.opacity = '1';
            overlay.innerHTML = '';
            if(cam.srcObject) cam.srcObject.getTracks().forEach(t => t.stop());
        } else {
            analyzeWithAI();
        }
    }

    function create(type) {
        const val = document.getElementById('input-field').value;
        if(!val) return;

        navigator.geolocation.getCurrentPosition(p => {
            const db = JSON.parse(localStorage.getItem('TADY_CORE')) || [];
            db.push({
                msg: val, type: type, 
                lat: p.coords.latitude, lng: p.coords.longitude,
                date: new Date().toLocaleTimeString()
            });
            localStorage.setItem('TADY_CORE', JSON.stringify(db));
            document.getElementById('input-field').value = '';
            location.reload();
        });
    }

    function refreshData() {
        const db = JSON.parse(localStorage.getItem('TADY_CORE')) || [];
        db.forEach(s => {
            const color = s.type === 'gold' ? '#ffd700' : '#00f2ff';
            L.circle([s.lat, s.lng], {radius: 25, color: color, fillOpacity: 0.7, weight: 2}).addTo(map);
        });
    }

    function startAR() {
        const overlay = document.getElementById('ar-overlay');
        const db = JSON.parse(localStorage.getItem('TADY_CORE')) || [];
        overlay.innerHTML = '';

        db.slice(-10).reverse().forEach((s, i) => {
            const b = document.createElement('div');
            b.className = `bubble ${s.type === 'gold' ? 'gold' : ''}`;
            // Algoritmus pro rozprost≈ôen√≠ v AR prostoru
            b.style.left = (Math.random() * 50 + 10) + '%';
            b.style.top = (20 + (i * 10)) + '%';
            b.style.animationDelay = (i * 0.3) + 's';
            
            b.innerHTML = `
                <div class="meta">${s.type === 'gold' ? '‚≠ê Premium Business' : 'üìç Social Pin'}</div>
                <div>${s.msg}</div>
                <div style="font-size:0.5rem; margin-top:10px; opacity:0.5;">${s.date}</div>
            `;
            
            // Kliknut√≠m na byznys stopu se m≈Ø≈æe otev≈ô√≠t kontakt
            if(s.type === 'gold') {
                b.onclick = () => alert("Propojuji s partnerem...");
            }
            
            overlay.appendChild(b);
        });
    }

    async function analyzeWithAI() {
        const db = JSON.parse(localStorage.getItem('TADY_CORE')) || [];
        const context = db.length > 0 ? db.map(d => d.msg).join(". ") : "≈Ω√°dn√° data.";
        
        alert("Glob√°ln√≠ AI TADY analyzuje kontext: " + context.substring(0, 50) + "...");
        
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${G_KEY}`;
        try {
            const res = await fetch(url, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ contents: [{ parts: [{ text: `Jsi mozek glob√°ln√≠ s√≠tƒõ TADY. Projekt vede M.D. Na z√°kladƒõ tƒõchto stop: "${context}" napi≈° 1 kr√°tkou vizion√°≈ôskou vƒõtu o budoucnosti tohoto m√≠sta.` }] }] })
            });
            const data = await res.json();
            alert("AI VIZE: " + data.candidates[0].content.parts[0].text);
        } catch(e) { alert("AI se probouz√≠, zkuste to za vte≈ôinu."); }
    }

    window.onload = init;
</script>
</body>
</html>

