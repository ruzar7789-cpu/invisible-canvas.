<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TADY - M.D.</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --p: #764ba2; --s: #667eea; --gold: #ffc107; --bg: #0b1118; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: sans-serif; background: var(--bg); color: #fff; overflow: hidden; }
        
        #landing-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, #162a35 0%, #0b1118 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5000; transition: 0.5s; }
        .landing-logo { font-size: 3.5rem; color: #00f2ff; font-weight: 900; letter-spacing: 5px; margin-bottom: 10px; text-shadow: 0 0 20px rgba(0,242,255,0.5); }
        .btn-vstoupit { background: #00f2ff; color: #0b1118; padding: 15px 45px; border-radius: 30px; font-weight: bold; border: none; cursor: pointer; font-size: 1.1rem; box-shadow: 0 5px 15px rgba(0,242,255,0.3); }

        #app-interface { display: none; width: 100%; height: 100%; position: relative; }
        #ar-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1; overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }

        .ar-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }
        .vzkaz-float { position: absolute; background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.3); color: white; font-size: 0.9rem; animation: float 6s infinite ease-in-out; pointer-events: auto; max-width: 200px; }

        @keyframes float { 0%, 100% { transform: translateY(0) rotate(-2deg); } 50% { transform: translateY(-20px) rotate(2deg); } }

        .ui-bottom { position: absolute; bottom: 30px; left: 0; width: 100%; z-index: 100; display: flex; flex-direction: column; align-items: center; pointer-events: none; }
        .input-box { background: rgba(255,255,255,0.9); width: 85%; padding: 15px; border-radius: 25px; display: flex; gap: 10px; pointer-events: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        input { flex: 1; border: none; outline: none; background: transparent; font-size: 1rem; color: #333; }
        .btn-add { background: var(--p); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; }

        .nav-tabs { position: absolute; top: 20px; width: 100%; display: flex; justify-content: center; gap: 10px; z-index: 100; }
        .tab { background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; cursor: pointer; border: 1px solid rgba(255,255,255,0.2); }
        .tab.active { background: var(--p); border-color: var(--p); }

        #map-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; display: none; }
    </style>
</head>
<body>

<div id="landing-page">
    <div class="landing-logo">TADY</div>
    <div style="color:white; margin-bottom:30px; opacity:0.8; letter-spacing: 2px;">PROJEKT M.D.</div>
    <button class="btn-vstoupit" onclick="startApp()">VSTOUPIT</button>
</div>

<div id="app-interface">
    <div class="nav-tabs">
        <div class="tab active" onclick="switchTab('ar')">KONTINUUM</div>
        <div class="tab" onclick="switchTab('map')">MAPA</div>
    </div>

    <div id="ar-view">
        <video id="video" autoplay playsinline></video>
        <div class="ar-overlay" id="ar-overlay"></div>
    </div>

    <div id="map-view"></div>

    <div class="ui-bottom">
        <div class="input-box">
            <input type="text" id="vzkaz-input" placeholder="Zanechte stopu...">
            <button class="btn-add" onclick="pridatVzkaz()">+</button>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    let vzkazy = JSON.parse(localStorage.getItem('stopy_md')) || [];
    let map;

    async function startApp() {
        document.getElementById('landing-page').style.opacity = '0';
        setTimeout(async () => {
            document.getElementById('landing-page').style.display = 'none';
            document.getElementById('app-interface').style.display = 'block';
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                document.getElementById('video').srcObject = stream;
            } catch (e) { console.log("Kamera nedostupnÃ¡"); }
            
            renderAR();
        }, 500);
    }

    function pridatVzkaz() {
        const txt = document.getElementById('vzkaz-input').value;
        if(!txt) return;

        navigator.geolocation.getCurrentPosition(pos => {
            const novy = {
                id: Date.now(),
                text: txt,
                autor: 'M.D.',
                lat: pos.coords.latitude,
                lng: pos.coords.longitude,
                x: Math.random() * 60 + 20,
                y: Math.random() * 50 + 20
            };
            vzkazy.push(novy);
            localStorage.setItem('stopy_md', JSON.stringify(vzkazy));
            document.getElementById('vzkaz-input').value = '';
            renderAR();
        });
    }

    function renderAR() {
        const container = document.getElementById('ar-overlay');
        container.innerHTML = vzkazy.slice(-5).map(v => `
            <div class="vzkaz-float" style="left: ${v.x}%; top: ${v.y}%;">
                <b>${v.autor}:</b><br>${v.text}
            </div>
        `).join('');
    }

    function switchTab(type) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        
        if(type === 'map') {
            document.getElementById('map-view').style.display = 'block';
            if(!map) {
                map = L.map('map-view').setView([50.91, 14.62], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            }
            vzkazy.forEach(v => L.marker([v.lat, v.lng]).addTo(map).bindPopup(v.text));
        } else {
            document.getElementById('map-view').style.display = 'none';
        }
    }
</script>
</body>
</html>
