<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TADY | M.D. OS</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIlRBRFkiLAogICJzaG9ydF9uYW1lIjogIlRBRFkiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzAwMDAwMCIsCiAgInRoZW1lX2NvbG9yIjogIiMwMGYyZmYiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2Nkbi1pY29ucy1wbmcuZmxhdGljb24uY29tLzUxMi8yNTMxLzI1MzE2NjkucG5nIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICB9CiAgXQp9">

    <style>
        :root { --glow: #00f2ff; --gold: #ffd700; --glass: rgba(10, 20, 30, 0.8); }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Inter', sans-serif; background: #000; color: #fff; overflow: hidden; }
        
        /* Vrstvy */
        #ar-view, #map-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; transition: 0.6s ease; }
        #ar-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }
        #ar-engine { width: 100%; height: 100%; object-fit: cover; filter: contrast(1.1); }
        .view-hidden { transform: scale(1.1); opacity: 0; pointer-events: none; }

        /* Hologramy 110% */
        .hologram {
            position: absolute; background: var(--glass); backdrop-filter: blur(15px);
            border-left: 4px solid var(--glow); border-radius: 12px; padding: 15px;
            animation: float 5s infinite ease-in-out; pointer-events: auto; min-width: 160px;
            box-shadow: 10px 10px 20px rgba(0,0,0,0.5);
        }
        .hologram.premium { border-left-color: var(--gold); border-right: 1px solid rgba(255,215,0,0.3); }
        .hologram h3 { margin: 0; font-size: 0.8rem; color: var(--glow); letter-spacing: 2px; text-transform: uppercase; }
        .hologram p { margin: 10px 0; font-size: 1.1rem; font-weight: 600; }
        
        .meta { display: flex; justify-content: space-between; font-size: 0.7rem; opacity: 0.5; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px; }

        /* Admin / UI */
        .footer-ui { position: fixed; bottom: 0; width: 100%; z-index: 1000; padding: 30px 0; background: linear-gradient(to top, #000 80%, transparent); text-align: center; }
        .brand { font-size: 2.2rem; font-weight: 900; letter-spacing: 10px; margin-bottom: 15px; background: linear-gradient(to right, #fff, var(--glow)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        nav { display: flex; justify-content: center; gap: 50px; }
        .nav-btn { font-size: 2.2rem; cursor: pointer; transition: 0.3s; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal-content { background: #0a0a0a; padding: 40px; border-radius: 40px; border: 1px solid var(--gold); text-align: center; width: 85%; }
        
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-20px) rotate(1deg); } }
    </style>
</head>
<body>

<div id="ar-view">
    <video id="ar-engine" autoplay playsinline></video>
    <div id="ar-overlay"></div>
</div>

<div id="map-view" class="view-hidden">
    <div id="map" style="width: 100%; height: 100%;"></div>
</div>

<div id="pay-modal" class="modal">
    <div class="modal-content">
        <h2 id="pay-title" style="color:var(--gold)">M.D. PLATBA</h2>
        <img id="qr-img" src="" style="width: 240px; background: white; padding: 15px; border-radius: 20px; margin: 20px 0;">
        <div style="font-size: 2rem; font-weight: 900;">29,- Kƒç</div>
        <p style="opacity: 0.5; font-size: 0.8rem;">Variabiln√≠ symbol: TADY-MD</p>
        <button onclick="closePay()" style="width:100%; padding:18px; border-radius:20px; background:var(--gold); border:none; font-weight:900; margin-top:20px;">POTVRDIT PLATBU</button>
    </div>
</div>

<div class="footer-ui">
    <div class="brand">DOHROMADY</div>
    <nav>
        <div class="nav-btn" onclick="toggleMap()">üó∫Ô∏è</div>
        <div class="nav-btn" onclick="openCreator()">üí¨</div>
        <div class="nav-btn" onclick="adminMode()">üë§</div>
    </nav>
</div>

<script>
    let isMap = false;
    let map;
    const REVOLUT_IBAN = "LT533250082844018353";

    async function init() {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        document.getElementById('ar-engine').srcObject = stream;
        loadWorld();
    }

    function toggleMap() {
        isMap = !isMap;
        document.getElementById('map-view').classList.toggle('view-hidden', !isMap);
        document.getElementById('ar-view').classList.toggle('view-hidden', isMap);
        if(isMap && !map) initMap();
    }

    function initMap() {
        map = L.map('map', { zoomControl: false }).setView([50.91, 14.62], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        map.on('click', e => createStop(e.latlng.lat, e.latlng.lng));
    }

    async function createStop(lat, lng) {
        const text = prompt("Vzkaz pro svƒõt (TADY):");
        if(!text) return;
        
        // Odesl√°n√≠ do NEON DB (p≈ôes tv≈Øj endpoint)
        await fetch('/api/save', {
            method: 'POST',
            body: JSON.stringify({ lat, lng, text, type: 'premium', owner: 'M.D.' })
        });

        showPay(text);
    }

    function showPay(msg) {
        const qrData = `SPD*1.0*ACC:${REVOLUT_IBAN}*AM:29.00*CC:CZK*MSG:TADY-${encodeURIComponent(msg.substring(0,10))}`;
        document.getElementById('qr-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${qrData}`;
        document.getElementById('pay-modal').style.display = 'flex';
    }

    function closePay() { document.getElementById('pay-modal').style.display = 'none'; }

    function loadWorld() {
        // Simulace naƒçten√≠ z Neonu pro uk√°zku
        renderAR("Denn√≠ menu", "Gul√°≈° s pƒõti: 180,-", 40, 20, true, "14:00");
        renderAR("M.D. Vision", "V≈°echno d≈Øle≈æit√© je tady.", 15, 45, false, "24h");
    }

    function renderAR(title, text, x, y, premium, expiry) {
        const el = document.createElement('div');
        el.className = `hologram ${premium ? 'premium' : ''}`;
        el.style.left = x + '%'; el.style.top = y + '%';
        el.innerHTML = `
            <h3>${title}</h3>
            <p>${text}</p>
            <div class="meta">
                <span>‚ù§Ô∏è 0</span>
                <span>‚è≥ ${expiry}</span>
            </div>
        `;
        document.getElementById('ar-overlay').appendChild(el);
    }

    function openCreator() {
        alert("Vyber na mapƒõ m√≠sto pro svou stopu.");
        if(!isMap) toggleMap();
    }

    function adminMode() {
        const pass = prompt("Admin heslo (M.D.):");
        if(pass === "1234") { // P≈ô√≠klad tv√©ho hesla
            document.body.style.border = "2px solid gold";
            alert("Administr√°torsk√Ω re≈æim aktivn√≠. Kliknut√≠m na stopu ji sma≈æe≈°.");
        }
    }

    window.onload = init;
</script>
</body>
</html>
