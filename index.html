<div id="ad-bar">
    <div class="ad-card active" onclick="fastTrack('FIREMNÍ')">
        <span style="float:right; font-size:0.6rem; color:var(--gold)">Verified by M.D.</span>
        <h4>ZLATÁ STOPA</h4>
        <p>Chcete zde své menu? Klikněte a ukažte se!</p>
    </div>
    <div class="ad-card" onclick="fastTrack('OSOBNÍ')">
        <span style="float:right; font-size:0.6rem; color:var(--glow)">Verified by M.D.</span>
        <h4>OSOBNÍ VZKAZ</h4>
        <p>Zanechte stopu za 29 Kč. Viditelná pro všechny.</p>
    </div>
    <div class="ad-card" onclick="alert('Časové kapsle: Již brzy v M.D. Systému!')">
        <span style="float:right; font-size:0.6rem; color:var(--gold)">NEW</span>
        <h4>ČASOVÁ KAPSLE</h4>
        <p>Pošli vzkaz do budoucnosti. Otevře se za rok!</p>
    </div>
</div>

<script>
    // ... (předchozí proměnné zůstávají) ...

    // Nová funkce pro rychlou objednávku z banneru
    function fastTrack(type) {
        if(!isMapActive) toggleMap();
        alert(`Vyberte nyní na mapě místo pro vaši ${type} stopu.`);
        // Systém si zapamatuje, že po kliku na mapu má hned nabídnout daný tarif
        window.pendingType = type;
    }

    // Upravený klik na mapu pro FastTrack
    function setupMapEvents() {
        map.on('click', e => {
            selectedLat = e.latlng.lat;
            selectedLng = e.latlng.lng;
            if(window.pendingType) {
                initiatePayment(window.pendingType, window.pendingType === 'FIREMNÍ' ? 149 : 29);
                window.pendingType = null;
            } else {
                document.getElementById('tier-modal').style.display = 'flex';
            }
        });
    }

    // Upravená funkce toggleMap
    function toggleMap() {
        isMapActive = !isMapActive;
        const mapView = document.getElementById('map-view');
        const arEngine = document.getElementById('ar-engine');
        mapView.classList.toggle('active', isMapActive);
        arEngine.style.display = isMapActive ? 'none' : 'block';
        
        if (isMapActive && !map) {
            map = L.map('map', { zoomControl: false }).setView([50.91, 14.62], 15);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
            setupMapEvents(); // Volání nové funkce eventů
        }
        if(isMapActive) setTimeout(() => map.invalidateSize(), 100);
    }

    // Ostatní funkce zůstávají stejné...
</script>
