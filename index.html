<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TADY // invisible-canes // M.D.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;600;800&display=swap');
        :root { --accent-cyan: #00f2fe; --accent-gold: #ffca2c; --accent-purple: #bf5af2; --active-color: #00f2fe; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #000; color: white; margin: 0; overflow: hidden; touch-action: none; position: fixed; width: 100%; height: 100%; }

        /* INTRO SCREEN */
        .tady-logo { font-size: clamp(4rem, 12vw, 8rem); font-weight: 800; letter-spacing: -0.05em; line-height: 1; filter: drop-shadow(0 0 20px var(--accent-cyan)); }
        #loader-wrap { width: 200px; height: 2px; background: rgba(255,255,255,0.05); position: relative; }
        #loader-fill { width: 0%; height: 100%; background: var(--accent-cyan); box-shadow: 0 0 20px var(--accent-cyan); transition: width 3s linear; }

        /* VZKAZ - OPRAVENÝ POHYB A DOSAH */
        .neon-trace { 
            background: rgba(10, 10, 10, 0.6); backdrop-filter: blur(50px) saturate(200%); -webkit-backdrop-filter: blur(50px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 45px; padding: 20px; 
            width: 90%; max-width: 360px; position: absolute; left: 50%; top: 48%; transform: translate(-50%, -50%);
            z-index: 4000; animation: glow 3s infinite;
            max-height: 80vh; display: flex; flex-direction: column; pointer-events: auto;
        }
        .trace-content { overflow-y: auto; flex: 1; padding-right: 5px; -webkit-overflow-scrolling: touch; }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 30px -10px var(--active-color); } 50% { box-shadow: 0 0 60px 0px var(--active-color); } }

        /* RADAR - PRIORITA 5000 */
        #radar-panel {
            position: absolute; bottom: 0; left: 0; right: 0; 
            background: rgba(0,0,0,0.98); border-top: 1px solid var(--accent-purple);
            z-index: 5000; transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            transform: translateY(calc(100% - 90px));
            border-radius: 40px 40px 0 0; padding-bottom: 30px;
        }
        #radar-panel.open { transform: translateY(0); }

        #map-bg { position: absolute; inset: 0; z-index: 1; filter: brightness(0.3) contrast(1.1); }
        .wave-bar { width: 3px; height: 15px; background: var(--active-color); border-radius: 5px; animation: wave 0.8s infinite alternate; }
        @keyframes wave { from { height: 4px; } to { height: 18px; } }
        .recording-active { background: #ff3b30 !important; box-shadow: 0 0 20px #ff3b30; color: white !important; }
    </style>
</head>
<body>

    <div id="landing-page" class="fixed inset-0 z-[9999] bg-black flex flex-col justify-center items-center">
        <div class="tady-logo italic text-white uppercase mb-4">TADY</div>
        <div class="text-[9px] font-black text-white/20 tracking-[1em] uppercase mb-12">invisible-canes system</div>
        <div id="loader-wrap"><div id="loader-fill"></div></div>
        <button onclick="bootApp()" id="boot-btn" class="hidden opacity-0 bg-white text-black font-black px-12 py-5 rounded-full text-[10px] tracking-[0.4em] uppercase italic mt-12 transition-all duration-700">Vstoupit</button>
    </div>

    <div id="app-interface" class="hidden h-screen w-screen flex flex-col overflow-hidden bg-black">
        
        <aside class="w-full md:w-[380px] bg-black p-8 flex flex-col z-[100] border-r border-white/5 overflow-y-auto">
            <div class="flex justify-between items-start mb-10">
                <div>
                    <div class="text-4xl font-black text-white italic tracking-tighter uppercase">TADY</div>
                    <div class="text-[8px] font-bold text-cyan-400 tracking-[0.4em] uppercase">invisible-canes</div>
                </div>
                <div class="text-[7px] font-black text-white/20 uppercase border border-white/10 px-2 py-1 rounded">Founder M.D.</div>
            </div>
            
            <div class="space-y-5">
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setMode('personal')" id="btn-p" class="p-4 rounded-2xl border border-white/10 text-[8px] font-black uppercase text-cyan-400 border-cyan-400">Personal</button>
                    <button onclick="setMode('business')" id="btn-b" class="p-4 rounded-2xl border border-white/10 text-[8px] font-black uppercase text-white/20">Business</button>
                    <button onclick="setMode('capsule')" id="btn-c" class="p-4 rounded-2xl border border-white/10 text-[8px] font-black uppercase text-white/20">Capsule</button>
                </div>

                <input type="text" id="t-title" class="w-full p-5 bg-white/5 border border-white/10 rounded-2xl text-[10px] font-bold text-white uppercase outline-none focus:border-cyan-400" placeholder="NÁZEV ZÁZNAMU">
                <textarea id="t-desc" class="w-full p-5 bg-white/5 border border-white/10 rounded-2xl text-[10px] h-24 resize-none text-white outline-none focus:border-cyan-400" placeholder="VÁŠ VZKAZ..."></textarea>

                <div class="grid grid-cols-2 gap-3">
                    <button onclick="document.getElementById('t-img').click()" class="bg-white/5 p-5 rounded-2xl text-[8px] font-black text-white/30 flex items-center justify-center gap-2 border border-white/5"><i class="fas fa-camera"></i> FOTO</button>
                    <button onclick="startAudio()" id="mic-btn" class="bg-white/5 p-5 rounded-2xl text-[8px] font-black text-white/30 flex items-center justify-center gap-2 border border-white/5"><i class="fas fa-microphone"></i> AUDIO</button>
                    <input type="file" id="t-img" accept="image/*" class="hidden" onchange="handleImage(this)">
                </div>

                <button onclick="prepareTrace()" class="w-full bg-cyan-400 text-black py-7 rounded-[35px] font-black text-[11px] uppercase tracking-[0.5em] italic mt-2 shadow-lg">Ukotvit</button>
            </div>
        </aside>

        <main class="flex-1 relative bg-black overflow-hidden">
            <video id="ar-video" autoplay playsinline muted></video>
            <div id="map-bg" class="h-full w-full"></div>
            
            <div id="trace-container" class="absolute inset-0 z-[3000] pointer-events-none"></div>
            
            <button onclick="toggleCam()" class="absolute top-6 right-6 z-[3500] w-14 h-14 rounded-2xl bg-white text-black flex items-center justify-center shadow-2xl border-4 border-black">
                <i id="cam-icon" class="fas fa-expand text-lg"></i>
            </button>

            <div id="radar-panel">
                <div class="h-[90px] flex flex-col items-center justify-center cursor-pointer touch-none" onclick="toggleRadar()">
                    <div class="w-12 h-1 bg-white/20 rounded-full mb-3"></div>
                    <div class="text-[9px] font-black tracking-[0.6em] text-purple-400 uppercase italic">Radar Energie</div>
                </div>
                <div class="px-8 pb-10 space-y-4 max-h-[400px] overflow-y-auto" id="radar-list">
                    <div class="flex justify-between items-center p-5 bg-white/5 rounded-3xl border border-white/5">
                        <div class="flex items-center gap-4">
                            <div class="flex gap-1 h-4"><div class="wave-bar"></div><div class="wave-bar" style="animation-delay:0.2s"></div></div>
                            <div><div class="text-[12px] font-black uppercase">M.D. Jádro</div><div class="text-[8px] text-white/20">Authorized Master</div></div>
                        </div>
                        <div class="text-cyan-400 font-black text-[10px]">0m</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="pay-modal" class="fixed inset-0 z-[6000] bg-black/98 hidden justify-center items-center backdrop-blur-3xl">
        <div class="w-full max-w-xs p-10 text-center">
            <div id="pay-price" class="text-8xl font-black italic text-white mb-10 tracking-tighter">29</div>
            <button onclick="confirmAll()" class="w-full bg-white text-black py-7 rounded-[35px] font-black text-[11px] tracking-[0.4em] uppercase">Potvrdit</button>
        </div>
    </div>

    <script>
        let map, currentMode = 'personal', activeTrace = null, selectedImg = null, mediaRecorder, audioChunks = [], isRecording = false;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const config = { personal: { price: '29 Kč', color: '#00f2fe' }, business: { price: '199 Kč', color: '#ffca2c' }, capsule: { price: '49 Kč', color: '#bf5af2' } };

        // BOOT
        window.onload = () => {
            document.getElementById('loader-fill').style.width = '100%';
            setTimeout(() => { 
                const btn = document.getElementById('boot-btn');
                btn.classList.remove('hidden'); 
                setTimeout(() => btn.style.opacity = '1', 100);
            }, 3000);
        };

        function playSound(f, d) {
            const o = audioCtx.createOscillator(), g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            o.frequency.value = f; g.gain.setValueAtTime(0.05, audioCtx.currentTime);
            o.start(); o.stop(audioCtx.currentTime + d);
        }

        function bootApp() { 
            playSound(1000, 0.2);
            document.getElementById('landing-page').style.display = 'none'; 
            document.getElementById('app-interface').classList.remove('hidden'); 
            initMap(); 
        }

        function initMap() {
            map = L.map('map-bg', { zoomControl: false, attributionControl: false }).setView([50.912, 14.619], 16);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        }

        function setMode(m) {
            currentMode = m; playSound(600, 0.1);
            document.querySelectorAll('aside button').forEach(b => b.classList.remove('text-cyan-400', 'border-cyan-400', 'text-white/20'));
            document.getElementById(`btn-${m[0]}`).classList.add('text-cyan-400', 'border-cyan-400');
            document.documentElement.style.setProperty('--active-color', config[m].color);
        }

        // AUDIO NAHRÁVÁNÍ 1000%
        async function startAudio() {
            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.start();
                    isRecording = true;
                    document.getElementById('mic-btn').classList.add('recording-active');
                    playSound(1200, 0.1);
                } catch(e) { alert("Přístup k mikrofonu odmítnut."); }
            } else {
                mediaRecorder.stop();
                isRecording = false;
                document.getElementById('mic-btn').classList.remove('recording-active');
                playSound(800, 0.1);
            }
        }

        function handleImage(input) {
            const r = new FileReader();
            r.onload = (e) => { selectedImg = e.target.result; playSound(1500, 0.1); };
            r.readAsDataURL(input.files[0]);
        }

        function toggleRadar() { 
            document.getElementById('radar-panel').classList.toggle('open'); 
            playSound(400, 0.1); 
        }

        async function toggleCam() {
            const v = document.getElementById('ar-video'), m = document.getElementById('map-bg');
            if(v.style.display === 'none' || v.style.display === '') {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                v.srcObject = stream; v.style.display = 'block'; m.style.opacity = '0'; v.play();
            } else {
                v.style.display = 'none'; m.style.opacity = '1';
            }
        }

        function prepareTrace() {
            playSound(900, 0.2);
            if(activeTrace) activeTrace.remove();
            
            activeTrace = document.createElement('div');
            activeTrace.className = "neon-trace";
            
            let img = selectedImg ? `<img src="${selectedImg}" class="w-full h-44 object-cover rounded-[30px] mb-6">` : '';
            let timer = currentMode === 'capsule' ? `<div id="live-timer" class="text-[9px] font-black text-center text-purple-400 mb-4 tracking-widest">ENCRYPTING...</div>` : '';

            activeTrace.innerHTML = `
                ${timer}
                <div class="flex justify-center gap-1.5 mb-6 h-5"><div class="wave-bar"></div><div class="wave-bar" style="animation-delay:0.2s"></div><div class="wave-bar" style="animation-delay:0.4s"></div></div>
                <div class="trace-content">
                    <h2 class="text-2xl font-black italic uppercase text-center mb-2 tracking-tighter">${document.getElementById('t-title').value || 'BEZE JMÉNA'}</h2>
                    <p class="text-[11px] text-white/50 italic text-center mb-8 px-2 leading-relaxed">"${document.getElementById('t-desc').value || 'AudioSenzor záznam ukotven v invisible-canes.'}"</p>
                    ${img}
                </div>
                <button onclick="showPay()" class="w-full bg-white text-black py-6 rounded-[30px] font-black text-[11px] uppercase tracking-widest mt-4">Aktivovat</button>
            `;
            document.getElementById('trace-container').appendChild(activeTrace);
        }

        function showPay() {
            document.getElementById('pay-price').innerText = config[currentMode].price.split(' ')[0];
            document.getElementById('pay-modal').style.display = 'flex';
        }

        function confirmAll() {
            playSound(1500, 0.5);
            document.getElementById('pay-modal').style.display = 'none';
            if(activeTrace) activeTrace.remove();
            
            const list = document.getElementById('radar-list');
            const item = document.createElement('div');
            item.className = 'flex justify-between items-center p-5 bg-white/5 rounded-3xl border border-white/5 mb-3';
            item.innerHTML = `
                <div class="flex items-center gap-4">
                    <div class="flex gap-1 h-3"><div class="wave-bar" style="background:${config[currentMode].color}"></div><div class="wave-bar" style="background:${config[currentMode].color}"></div></div>
                    <div><div class="text-[12px] font-black uppercase">${document.getElementById('t-title').value || 'ZÁZNAM'}</div><div class="text-[8px] text-white/20 uppercase">${currentMode}</div></div>
                </div>
                <div class="font-black italic text-[10px]" style="color:${config[currentMode].color}">0m</div>
            `;
            list.prepend(item);
            alert("SYSTEM: Ukotveno.");
        }
    </script>
</body>
</html>
