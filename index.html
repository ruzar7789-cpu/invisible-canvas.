<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TADY - Global Network</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --p: #764ba2; --s: #667eea; --gold: #ffc107; --sos: #ff4b2b; --bg: #0b1118; --cyan: #00f2ff; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; overflow: hidden; }

        /* UI VRSTVY */
        #app-interface { display: flex; flex-direction: column; height: 100vh; background: #f0f2f5; color: #333; }
        header { 
            background: linear-gradient(135deg, var(--s), var(--p)); color: white; padding: 15px; 
            text-align: center; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .container { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 100px; }
        .card { background: white; border-radius: 25px; padding: 20px; margin-bottom: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); position: relative; overflow: hidden; }
        
        /* STATUS INDIK√ÅTOR S√çTƒö */
        #network-status { font-size: 0.7rem; color: #444; margin-top: 5px; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .dot { width: 8px; height: 8px; background: #4caf50; border-radius: 50%; animation: pulse 2s infinite; }

        /* AR RE≈ΩIM - FULLSCREEN */
        #ar-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: none; z-index: 2000; }
        #camera-feed { width: 100%; height: 100%; object-fit: cover; }
        .ar-label { 
            position: absolute; background: rgba(0,0,0,0.7); color: white; padding: 12px; border-radius: 15px;
            border: 1px solid var(--cyan); backdrop-filter: blur(8px); transform: translate(-50%, -50%); pointer-events: none;
        }

        /* GLOB√ÅLN√ç FEED */
        .feed-item { border-left: 4px solid var(--p); padding-left: 15px; margin-bottom: 20px; }
        .feed-item.sos { border-left-color: var(--sos); background: rgba(255,75,43,0.05); }

        /* NAVIGACE */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #ddd; z-index: 1000; }
        .nav-item { text-align: center; font-size: 0.75rem; color: #aaa; flex: 1; cursor: pointer; }
        .nav-item.active { color: var(--p); font-weight: bold; }
        
        .btn-main { background: var(--p); color: white; border: none; padding: 15px; width: 100%; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #map { height: 300px; border-radius: 20px; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

<div id="app-interface">
    <header>
        <h1 style="margin:0; letter-spacing: 4px; font-size: 1.5rem;">TADY</h1>
        <div id="network-status"><div class="dot"></div> GLOB√ÅLN√ç S√ç≈§ AKTIVN√ç</div>
    </header>

    <div class="container">
        <div class="card">
            <h3 style="margin-top:0">üìç Ukotvit novou zpr√°vu</h3>
            <textarea id="msg-input" placeholder="Co se tady dƒõje?" style="width:100%; border:1px solid #ddd; border-radius:10px; padding:10px; font-family:inherit; box-sizing:border-box;"></textarea>
            <select id="msg-type" style="width:100%; margin-top:10px; padding:10px; border-radius:10px;">
                <option value="public">üí¨ Ve≈ôejn√° stopa</option>
                <option value="biz">üèÜ Patriot (Komerƒçn√≠)</option>
                <option value="sos">üö® SOS Nouze</option>
            </select>
            <button class="btn-main" onclick="sendToGlobalNetwork()">P≈òI≈†PENDLIT DO S√çTƒö</button>
        </div>

        <div class="card">
            <h3 style="margin-top:0">Pr√°vƒõ teƒè v okol√≠</h3>
            <div id="global-feed">Naƒç√≠t√°m stopy z cloudu...</div>
        </div>

        <div class="card">
            <h3>Digit√°ln√≠ mapa s√≠tƒõ</h3>
            <div id="map"></div>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-item active">üè†<br>Feed</div>
        <div class="nav-item" onclick="toggleAR(true)">‚ú®<br>AR Svƒõt</div>
        <div class="nav-item">üíº<br>Byznys</div>
        <div class="nav-item">üë§<br>Profil</div>
    </nav>
</div>

<div id="ar-screen">
    <video id="camera-feed" autoplay playsinline></video>
    <div id="ar-overlay" style="position:absolute; top:0; left:0; width:100%; height:100%;"></div>
    <button onclick="toggleAR(false)" style="position:fixed; bottom:40px; left:50%; transform:translateX(-50%); padding:15px 30px; border-radius:30px; border:none; background:var(--cyan); font-weight:bold;">Zpƒõt do menu</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // --- KONFIGURACE GLOB√ÅLN√ç S√çTƒö (Supabase) ---
    // Pozn√°mka: Zde by byly va≈°e re√°ln√© kl√≠ƒçe po registraci projektu
    const supabaseUrl = 'https://vase-id.supabase.co';
    const supabaseKey = 'vase-anonymni-klic';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    let map;
    let markers = [];

    // 1. NAƒåTEN√ç STOP Z GLOB√ÅLN√ç S√çTƒö
    async function loadGlobalNetwork() {
        const feedContainer = document.getElementById('global-feed');
        
        // Simulace vol√°n√≠ serveru (v re√°ln√© verzi: await supabase.from('stopy').select('*'))
        const globalStopy = JSON.parse(localStorage.getItem('tady_global')) || [
            { txt: "V√≠tejte v glob√°ln√≠ s√≠ti TADY!", type: "public", lat: 50.08, lng: 14.43, time: "Syst√©m" }
        ];

        feedContainer.innerHTML = "";
        globalStopy.reverse().forEach(s => {
            const div = document.createElement('div');
            div.className = `feed-item ${s.type}`;
            div.innerHTML = `<strong>${s.type.toUpperCase()}</strong> ‚Ä¢ <small>${s.time}</small><p>${s.txt}</p>`;
            feedContainer.appendChild(div);
        });

        updateMap(globalStopy);
        updateAR(globalStopy);
    }

    // 2. ODESL√ÅN√ç DO GLOB√ÅLN√ç S√çTƒö
    async function sendToGlobalNetwork() {
        const txt = document.getElementById('msg-input').value;
        const type = document.getElementById('msg-type').value;
        if(!txt) return alert("Napi≈°te zpr√°vu.");

        navigator.geolocation.getCurrentPosition(async (pos) => {
            const newStopa = {
                txt, type,
                lat: pos.coords.latitude,
                lng: pos.coords.longitude,
                time: new Date().toLocaleTimeString()
            };

            // ULO≈ΩEN√ç DO CLOUDU
            // V re√°ln√© verzi: await supabase.from('stopy').insert([newStopa]);
            let cloud = JSON.parse(localStorage.getItem('tady_global')) || [];
            cloud.push(newStopa);
            localStorage.setItem('tady_global', JSON.stringify(cloud));

            document.getElementById('msg-input').value = "";
            loadGlobalNetwork();
            alert("Ulo≈æeno do glob√°ln√≠ s√≠tƒõ!");
        });
    }

    // 3. MAPA A AR
    function updateMap(stopy) {
        if(!map) {
            map = L.map('map').setView([50.08, 14.43], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        }
        stopy.forEach(s => L.circle([s.lat, s.lng], {radius: 100, color: s.type === 'sos' ? 'red' : 'purple'}).addTo(map));
    }

    function updateAR(stopy) {
        const overlay = document.getElementById('ar-overlay');
        overlay.innerHTML = "";
        stopy.slice(-5).forEach((s, i) => {
            const div = document.createElement('div');
            div.className = "ar-label";
            div.style.left = (20 + (i * 15)) + "%";
            div.style.top = (30 + (i * 10)) + "%";
            div.innerHTML = `<b>${s.type.toUpperCase()}</b><br>${s.txt}`;
            overlay.appendChild(div);
        });
    }

    async function toggleAR(show) {
        if(show) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                document.getElementById('camera-feed').srcObject = stream;
                document.getElementById('ar-screen').style.display = 'block';
            } catch(e) { alert("Chyba kamery."); }
        } else {
            const stream = document.getElementById('camera-feed').srcObject;
            if(stream) stream.getTracks().forEach(t => t.stop());
            document.getElementById('ar-screen').style.display = 'none';
        }
    }

    // Start
    window.onload = loadGlobalNetwork;
</script>
</body>
</html>
