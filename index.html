<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TADY | M.D. PAY</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root { --gold: #ffd700; --dark: #0a0a0a; }
        body, html { margin: 0; padding: 0; height: 100%; background: #000; font-family: sans-serif; color: white; overflow: hidden; }
        #ar-engine { position: fixed; top: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
        #map-view { position: fixed; top: 0; width: 100%; height: 100%; z-index: 100; display: none; }
        
        /* PLOVOUC√ç REKLAMY */
        #ar-overlay { position: fixed; top: 0; width: 100%; height: 100%; z-index: 50; pointer-events: none; }
        .ad { position: absolute; background: rgba(0,0,0,0.8); border: 2px solid var(--gold); padding: 15px; border-radius: 15px; pointer-events: auto; animation: pulse 2s infinite; text-align: center; width: 120px; }
        @keyframes pulse { 0% { box-shadow: 0 0 5px var(--gold); } 50% { box-shadow: 0 0 20px var(--gold); } 100% { box-shadow: 0 0 5px var(--gold); } }

        /* PLATEBN√ç MODAL - TOT√ÅLN√ç PRIORITA */
        #pay-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .pay-box { background: #111; border: 2px solid var(--gold); padding: 30px; border-radius: 30px; text-align: center; width: 80%; }
        
        /* ADMIN */
        #admin-dash { position: fixed; bottom: 100px; width: 90%; left: 5%; background: var(--gold); color: black; padding: 20px; border-radius: 20px; z-index: 5000; display: none; max-height: 50%; overflow-y: auto; }
        .nav { position: fixed; bottom: 20px; width: 100%; z-index: 1000; text-align: center; }
        .btn { background: var(--gold); border: none; padding: 15px 30px; border-radius: 50px; font-weight: bold; font-size: 1rem; margin: 10px; cursor: pointer; }
    </style>
</head>
<body>

<video id="ar-engine" autoplay playsinline muted></video>

<div id="ar-overlay">
    <div class="ad" style="top:20%; left:10%;" onclick="startProcess('FIREMN√ç')"><b>ZLAT√Å</b><br>149 Kƒç</div>
    <div class="ad" style="top:40%; right:10%; border-color:#00f2ff;" onclick="startProcess('OSOBN√ç')"><b>VZKAZ</b><br>29 Kƒç</div>
</div>

<div id="map-view"><div id="map" style="width:100%; height:100%;"></div></div>

<div id="pay-modal">
    <div class="pay-box">
        <h2 style="color:var(--gold); margin-top:0;">ZAPLATIT M.D.</h2>
        <div style="background:white; padding:10px; border-radius:15px; display:inline-block;">
            <img id="qr-img" style="width:200px; height:200px; display:block;">
        </div>
        <h1 id="price-display" style="margin:15px 0;">0 Kƒç</h1>
        <p style="font-size:0.8rem; opacity:0.7;">Vzkaz bude aktivov√°n po p≈ôijet√≠ platby.</p>
        <button class="btn" onclick="finishPayment()">M√ÅM ZAPLACENO</button>
    </div>
</div>

<div id="admin-dash">
    <h3 style="margin:0">M.D. ADMIN PANEL</h3>
    <div id="admin-list"></div>
    <button onclick="location.reload()" style="margin-top:10px; width:100%;">ODHL√ÅSIT</button>
</div>

<div class="nav">
    <button class="btn" onclick="toggleMap()">üó∫Ô∏è MAPA / AR</button>
    <button class="btn" onclick="adminLogin()">üë§ ADMIN</button>
</div>

<script>
    let map, isMap = false, vzkazy = [], currentType = null;
    const IBAN = "LT533250082844018353";

    function toggleMap() {
        isMap = !isMap;
        document.getElementById('map-view').style.display = isMap ? 'block' : 'none';
        if(isMap && !map) {
            map = L.map('map', { zoomControl: false }).setView([50.91, 14.62], 15);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
            map.on('click', e => {
                let t = confirm("OK = FIREMN√ç (149,-) | ZRU≈†IT = OSOBN√ç (29,-)") ? 'FIREMN√ç' : 'OSOBN√ç';
                handleOrder(t, e.latlng.lat, e.latlng.lng);
            });
        }
        if(isMap) setTimeout(() => map.invalidateSize(), 200);
    }

    function startProcess(type) {
        alert("Nyn√≠ klikni na mapu, kam chce≈° vzkaz um√≠stit.");
        currentType = type;
        toggleMap();
    }

    function handleOrder(type, lat, lng) {
        let txt = prompt(`Tv≈Øj vzkaz pro ${type}:`);
        if(!txt) return;

        let cena = type === 'FIREMN√ç' ? 149 : 29;
        
        // 1. Z√ÅZNAM DO ADMINA (doƒçasn√Ω v RAM)
        vzkazy.push({ type, txt, lat, lng, active: false });

        // 2. GENERUJ QR A UKA≈Ω MODAL
        let qrData = `SPD*1.0*ACC:${IBAN}*AM:${cena}.00*CC:CZK*MSG:TADY`;
        document.getElementById('qr-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(qrData)}`;
        document.getElementById('price-display').innerText = cena + " Kƒç";
        document.getElementById('pay-modal').style.display = 'flex';
    }

    function finishPayment() {
        document.getElementById('pay-modal').style.display = 'none';
        alert("Vzkaz byl odesl√°n ke schv√°len√≠ administr√°torovi M.D.");
        if(isMap) toggleMap();
    }

    function adminLogin() {
        if(prompt("HESLO:") === "2025") {
            document.getElementById('admin-dash').style.display = 'block';
            renderAdmin();
        }
    }

    function renderAdmin() {
        const list = document.getElementById('admin-list');
        list.innerHTML = vzkazy.length ? "" : "≈Ω√°dn√© vzkazy.";
        vzkazy.forEach((v, i) => {
            list.innerHTML += `<div style="border-bottom:1px solid black; padding:10px;">
                <b>${v.type}:</b> ${v.txt}<br>
                <button onclick="activate(${i})">SCHV√ÅLIT</button> 
                <button onclick="vzkazy.splice(${i},1); renderAdmin()">SMAZAT</button>
            </div>`;
        });
    }

    function activate(i) { vzkazy[i].active = true; alert("Vzkaz je teƒè viditeln√Ω!"); renderAdmin(); }

    window.onload = () => {
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(s => document.getElementById('ar-engine').srcObject = s);
    };
</script>
</body>
</html>
