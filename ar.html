<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TADY - AR Prostor</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        .back-btn { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 9999; background: #000; color: #00e676; border: 2px solid #00e676; padding: 15px 30px; border-radius: 50px; font-weight: bold; text-decoration: none; font-family: sans-serif; box-shadow: 0 0 20px rgba(0,230,118,0.5); }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <a href="/" class="back-btn">ZPĚT NA MAPU</a>

    <a-scene vr-mode-ui="enabled: false" embedded arjs="sourceType: webcam; debugUIEnabled: false; videoTexture: true;">
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
        window.onload = async () => {
            try {
                const res = await fetch('/api/get-traces');
                const data = await res.json();
                const scene = document.querySelector('a-scene');

                data.forEach(stopa => {
                    if (stopa.lat && stopa.lng) {
                        // 1. KONTEJNER PRO OBJEKT (vše se hýbe spolu)
                        const container = document.createElement('a-entity');
                        container.setAttribute('gps-entity-place', `latitude: ${stopa.lat}; longitude: ${stopa.lng};`);
                        container.setAttribute('look-at', '[gps-camera]');

                        // 2. OBRÁZEK / FOTKA
                        const img = document.createElement('a-image');
                        const imgSource = stopa.image_url ? stopa.image_url : 'https://cdn-icons-png.flaticon.com/512/2618/2618254.png';
                        img.setAttribute('src', imgSource);
                        img.setAttribute('scale', '6 6 6');
                        img.setAttribute('position', '0 2 0'); // Fotka bude trochu výš
                        container.appendChild(img);

                        // 3. TEXTOVÝ POPISEK (Neonový vzkaz)
                        const text = document.createElement('a-text');
                        // Odstraníme z textu tagy jako [public-msg] pro čistý vzhled
                        const cistyText = stopa.content.includes('] ') ? stopa.content.split('] ')[1] : stopa.content;
                        
                        text.setAttribute('value', cistyText);
                        text.setAttribute('align', 'center');
                        text.setAttribute('color', '#00e676'); // Neonově zelená
                        text.setAttribute('scale', '4 4 4');
                        text.setAttribute('position', '0 -2 0'); // Text bude pod fotkou
                        container.appendChild(text);

                        scene.appendChild(container);
                    }
                });
            } catch (err) {
                console.error("AR Error:", err);
            }
        };
    </script>
</body>
</html>
